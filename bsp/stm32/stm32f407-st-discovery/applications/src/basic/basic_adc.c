/*
 * @ : ***************************************************************************************
 * @Description: 
 * @version: 
 * @Author: liwei
 * @Date: 2019-10-26 15:58:55
 * @LastEditTime: 2019-10-27 15:07:34
 * @  : ***************************************************************************************
 */
/******************************************************************************************
** 头文件
*******************************************************************************************/
#include "../../inc/basic/basic_adc.h"

/********************************************************************************************
** 定义变量
********************************************************************************************/

	
/********************************************************************************************
** 函数申明
********************************************************************************************/
/********************************************************************************************
** 内容
********************************************************************************************/

/********************************************************************************************
** 函数名称：	
** 函数作用：获取某个通道ADC值
** 参数：   channel 通道号
** 返回值:该通道的电压值,该电压值为实际电压值的 100倍

********************************************************************************************/
uint32_t basic_adc_get_volt(uint8_t adc_channel)
{
	char adc_name[128] = {0};
    rt_adc_device_t  adc_dev = 0;
    rt_err_t         ret = RT_EOK;
	uint32_t    get_value = 0,voltage = 0;
	
	rt_snprintf(adc_name, sizeof(adc_name)-1, ADC_DEV_NAME, adc_channel);      //设定设备名称

    //.......................................查找设备......................................
	adc_dev = (rt_adc_device_t)rt_device_find(adc_name);
	if(adc_dev == RT_NULL)
     {
		rt_kprintf(" can't find %s device!\n",  adc_name);
        return RT_ERROR;
	}

   //....................................... 使能设备......................................
    ret = rt_adc_enable(adc_dev,adc_channel);

   //....................................... 读取采样值......................................
    get_value = rt_adc_read(adc_dev, adc_channel);
    voltage =   get_value * ADC_VREF / 4096;
    //rt_kprintf("the voltage is :%d.%02d \n", vol / 100, vol % 100);

    //.......................................关闭通道......................................
    ret = rt_adc_disable(adc_dev, adc_channel);

	return voltage;
}

